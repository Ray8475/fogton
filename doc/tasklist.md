# –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (Tasklist)

–ò—Ç–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–ª–∞–Ω –ø–æ [vision.md](../vision.md). –ö–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞. KISS.

---

## –û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É

| –ò—Ç–µ—Ä–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å | –î–∞—Ç–∞ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|----------|--------|------|------------|
| 1. –ë–æ—Ç: /start –∏ –∫–Ω–æ–ø–∫–∞ | ‚úÖ –ì–æ—Ç–æ–≤–æ | 2025-01-29 | –ö–æ–¥ –≤ bot/app/main.py |
| 2. API: healthz –∏ –∑–∞–ø—É—Å–∫ | ‚úÖ –ì–æ—Ç–æ–≤–æ | 2025-01-29 | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π main.py, —Ç–æ–ª—å–∫–æ health |
| 3. –û–Ω–±–æ—Ä–¥–∏–Ω–≥: Mini App + auth + /me | ‚è≥ Pending | ‚Äî | |
| 4. –†—ã–Ω–∫–∏ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–µ–ø–æ–∑–∏—Ç–∞ | ‚è≥ Pending | ‚Äî | |
| 5. –î–µ–ø–æ–∑–∏—Ç: TON webhook –∏ –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ | ‚è≥ Pending | ‚Äî | |
| 6. –í—ã–≤–æ–¥ (–∑–∞—è–≤–∫–∞ –∏ —Å—Ç–∞—Ç—É—Å) | ‚è≥ Pending | ‚Äî | |
| 7. –ê–¥–º–∏–Ω: —Ä—ã–Ω–∫–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞ | ‚è≥ Pending | ‚Äî | |

**–õ–µ–≥–µ–Ω–¥–∞ —Å—Ç–∞—Ç—É—Å–æ–≤:** ‚úÖ –ì–æ—Ç–æ–≤–æ | üîÑ –í —Ä–∞–±–æ—Ç–µ | ‚è≥ –û–∂–∏–¥–∞–µ—Ç

---

## –ò—Ç–µ—Ä–∞—Ü–∏—è 1. –ë–æ—Ç: /start –∏ –∫–Ω–æ–ø–∫–∞ ¬´–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ¬ª

**–¶–µ–ª—å:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞; –ø–æ /start –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É, –æ—Ç–∫—Ä—ã–≤–∞—é—â—É—é Mini App. –ü—Ä–æ–≤–µ—Ä–∫–∞: –æ—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞ –≤ Telegram, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å /start, —É–≤–∏–¥–µ—Ç—å –∫–Ω–æ–ø–∫—É (–ø–µ—Ä–µ—Ö–æ–¥ –ø–æ WEBAPP_URL).

- [x] –ü–æ–¥–Ω—è—Ç—å –±–æ—Ç (aiogram), –∫–æ–º–∞–Ω–¥–∞ /start
- [x] –ö–Ω–æ–ø–∫–∞ ¬´–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ¬ª —Å URL –∏–∑ WEBAPP_URL (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω)
- [x] –†–µ–∂–∏–º: polling –∏–ª–∏ webhook –∏–∑ env (BOT_MODE, WEBHOOK_BASE_URL)
- [ ] **–¢–µ—Å—Ç:** /start –≤ –±–æ—Ç–µ ‚Üí –∫–Ω–æ–ø–∫–∞ –≤–µ–¥—ë—Ç –Ω–∞ WEBAPP_URL

---

## –ò—Ç–µ—Ä–∞—Ü–∏—è 2. API: healthz –∏ –∑–∞–ø—É—Å–∫

**–¶–µ–ª—å:** –ó–∞–ø—É—Å—Ç–∏—Ç—å API, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ë–î –≤ healthz. –ü—Ä–æ–≤–µ—Ä–∫–∞: curl GET /healthz ‚Üí 200 –∏ db ok.

- [x] –ó–∞–ø—É—Å–∫ API (FastAPI + uvicorn), –ø–æ—Ä—Ç 8000
- [x] GET /healthz: –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–Ω–æ–π –ë–î ‚Äî 200, {"status":"ok","db":"ok"}; –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–π –ë–î ‚Äî 503
- [x] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SQLite –ø–æ DATABASE_URL; —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (–ø–æ vision ‚Äî –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö)
- [ ] **–¢–µ—Å—Ç:** curl http://localhost:8000/healthz

---

## –ò—Ç–µ—Ä–∞—Ü–∏—è 3. –û–Ω–±–æ—Ä–¥–∏–Ω–≥: Mini App + auth + /me

**–¶–µ–ª—å:** –û—Ç–∫—Ä—ã—Ç—å Mini App –∏–∑ –±–æ—Ç–∞, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è (initData ‚Üí JWT), –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É –≤ –±–æ—Ç–µ ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Mini App ‚Üí –∑–∞–ø—Ä–æ—Å auth ‚Üí –∑–∞–ø—Ä–æ—Å /me ‚Üí –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–≤–æ–π user.

- [ ] Mini App (webapp): –æ–¥–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞, –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —á–∏—Ç–∞–µ—Ç initData –∏–∑ Telegram WebApp, —à–ª—ë—Ç POST /auth/telegram —Å init_data
- [ ] API: POST /auth/telegram ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ initData, —Å–æ–∑–¥–∞–Ω–∏–µ/–ø–æ–∏—Å–∫ user, –≤—ã–¥–∞—á–∞ JWT
- [ ] API: GET /me ‚Äî –ø–æ JWT –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ user (id, telegram_user_id)
- [ ] Mini App: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç JWT, –≤—ã–∑—ã–≤–∞–µ—Ç GET /me —Å Authorization: Bearer &lt;jwt&gt;, –≤—ã–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ user
- [ ] **–¢–µ—Å—Ç:** –±–æ—Ç ‚Üí ¬´–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ¬ª ‚Üí –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤–∏–¥–µ–Ω —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å (–∏–ª–∏ ¬´–í—ã –≤–æ—à–ª–∏¬ª)

---

## –ò—Ç–µ—Ä–∞—Ü–∏—è 4. –†—ã–Ω–∫–∏ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–µ–ø–æ–∑–∏—Ç–∞

**–¶–µ–ª—å:** –í Mini App –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Ä—ã–Ω–∫–æ–≤ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –¥–µ–ø–æ–∑–∏—Ç—É (–∞–¥—Ä–µ—Å + comment). –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤–∏–¥–µ–Ω —Å–ø–∏—Å–æ–∫ —Ä—ã–Ω–∫–æ–≤ –∏ –±–ª–æ–∫ ¬´–ü–æ–ø–æ–ª–Ω–∏—Ç—å¬ª —Å –∞–¥—Ä–µ—Å–æ–º –∏ comment.

- [ ] API: GET /markets ‚Äî —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä—ã–Ω–∫–æ–≤ (gift, expiry); –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤ (gifts, expiries, markets)
- [ ] API: GET /me/deposit-instruction ‚Äî –ø–æ JWT –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π comment (payload) –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] Mini App: —ç–∫—Ä–∞–Ω/–±–ª–æ–∫ —Ä—ã–Ω–∫–æ–≤ (—Å–ø–∏—Å–æ–∫); —ç–∫—Ä–∞–Ω/–±–ª–æ–∫ ¬´–ü–æ–ø–æ–ª–Ω–∏—Ç—å¬ª —Å –∞–¥—Ä–µ—Å–æ–º –∏ comment –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] **–¢–µ—Å—Ç:** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤–∏–¥–Ω—ã —Ä—ã–Ω–∫–∏ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–µ–ø–æ–∑–∏—Ç–∞ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º comment

---

## –ò—Ç–µ—Ä–∞—Ü–∏—è 5. –î–µ–ø–æ–∑–∏—Ç: TON webhook –∏ –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ

**–¶–µ–ª—å:** –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ webhook –æ—Ç TON API ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è, –∞—Ç—Ä–∏–±—É—Ü–∏—è –ø–æ comment, –∑–∞–ø–∏—Å—å –≤ deposits/ledger_entries, —É–≤–µ–ª–∏—á–µ–Ω–∏–µ balances. –ü—Ä–æ–≤–µ—Ä–∫–∞: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π webhook (–∏–ª–∏ —Å–∏–º—É–ª—è—Ü–∏—é) —Å comment –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–≤–µ–ª–∏—á–∏–ª—Å—è.

- [ ] API: POST /ton/webhook ‚Äî –ø—Ä–∏—ë–º payload (tx_hash, amount, comment, currency –∏ —Ç.–¥.), –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–∞
- [ ] –ü–æ comment –Ω–∞–π—Ç–∏ user_id; –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ tx_hash (–Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –¥–µ–ø–æ–∑–∏—Ç)
- [ ] –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ deposits (status credited), –∑–∞–ø–∏—Å—å –≤ ledger_entries, –æ–±–Ω–æ–≤–∏—Ç—å balances.available
- [ ] API: GET /me –∏–ª–∏ GET /me/balances ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –±–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] Mini App: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –±–∞–ª–∞–Ω—Å—ã (TON, USDT)
- [ ] **–¢–µ—Å—Ç:** webhook —Å comment –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å

---

## –ò—Ç–µ—Ä–∞—Ü–∏—è 6. –í—ã–≤–æ–¥ (–∑–∞—è–≤–∫–∞ –∏ —Å—Ç–∞—Ç—É—Å)

**–¶–µ–ª—å:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç –∑–∞—è–≤–∫—É –Ω–∞ –≤—ã–≤–æ–¥; API —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∑–∞—è–≤–∫—É –∏ (–ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏) –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç on-chain. –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Å–æ–∑–¥–∞—Ç—å –≤—ã–≤–æ–¥ ‚Üí –≤–∏–¥–µ–Ω —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏.

- [ ] –ú–æ–¥–µ–ª—å/—Ç–∞–±–ª–∏—Ü–∞ withdrawals (–ø–æ vision –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏)
- [ ] API: POST /me/withdraw ‚Äî amount, destination address; –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞, —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
- [ ] API: GET /me/withdrawals –∏–ª–∏ –≤ GET /me ‚Äî —Å–ø–∏—Å–æ–∫/—Å—Ç–∞—Ç—É—Å—ã –≤—ã–≤–æ–¥–æ–≤
- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ on-chain ‚Äî –∑–∞–≥–ª—É—à–∫–∞ –∏–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ (–ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º); —Ñ–∏–∫—Å–∞—Ü–∏—è tx_hash –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
- [ ] Mini App: —Ñ–æ—Ä–º–∞ –≤—ã–≤–æ–¥–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤
- [ ] **–¢–µ—Å—Ç:** —Å–æ–∑–¥–∞—Ç—å –≤—ã–≤–æ–¥ ‚Üí –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤–∏–¥–µ–Ω —Å—Ç–∞—Ç—É—Å (pending/completed/failed)

---

## –ò—Ç–µ—Ä–∞—Ü–∏—è 7. –ê–¥–º–∏–Ω: —Ä—ã–Ω–∫–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞

**–¶–µ–ª—å:** –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å/–≤—ã–∫–ª—é—á–∞—Ç—å —Ä—ã–Ω–∫–∏ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–ª–∞–Ω—Å —Å –∑–∞–ø–∏—Å—å—é –≤ ledger. –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—ã–∑–æ–≤ –∞–¥–º–∏–Ω-—ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —Å ADMIN_TOKEN.

- [ ] API: –ø—Ä–æ–≤–µ—Ä–∫–∞ ADMIN_TOKEN –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization –¥–ª—è –∞–¥–º–∏–Ω-—Ä–æ—É—Ç–æ–≤
- [ ] PATCH (–∏–ª–∏ POST) –∞–¥–º–∏–Ω: –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å gift, expiry, market (is_active)
- [ ] POST –∞–¥–º–∏–Ω: –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (user_id, currency, delta, reason); –∑–∞–ø–∏—Å—å –≤ ledger_entries, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ balances
- [ ] **–¢–µ—Å—Ç:** curl —Å ADMIN_TOKEN ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å is_active —Ä—ã–Ω–∫–∞; –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å –∏ ledger

---

## –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏

1. –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ –ø—É–Ω–∫—Ç—É **–¢–µ—Å—Ç**.
2. –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É ¬´–û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É¬ª: –ø–æ—Å—Ç–∞–≤–∏—Ç—å ‚úÖ –∏–ª–∏ üîÑ, —É–∫–∞–∑–∞—Ç—å –¥–∞—Ç—É –∏ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
