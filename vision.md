# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –≤–∏–¥–µ–Ω–∏–µ (Vision) ‚Äî Gifts Futures Telegram App

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç ‚Äî **–æ—Ç–ø—Ä–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –¥–ª—è MVP** –∏ ‚Äú—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–µ–∫—Ç‚Äù –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
–¶–µ–ª—å ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º **KISS** –±–µ–∑ –æ–≤–µ—Ä–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–∞.

–û—Å–Ω–æ–≤–∞ –∏–¥–µ–∏: `idea.md`.

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
- –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (KISS)
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–≤ —Ç.—á. –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è Mermaid)
- –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö
- –†–∞–±–æ—Ç–∞ —Å Telegram App (Mini App + Bot)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã (MVP)
- –ë–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏–∏ (–ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞)
- –î–µ–ø–ª–æ–π
- –°–±–æ—Ä–∫–∞ –∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
- –§–æ—Ä–º–∞—Ç –≤–µ–¥–µ–Ω–∏—è –ª–æ–≥–æ–≤ (—á—Ç–æ, –∫–∞–∫ –∏ –≥–¥–µ –∂—É—Ä–Ω–∞–ª–∏—Ä—É–µ–º)

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

### Telegram
- **–§–æ—Ä–º–∞—Ç**: Telegram **Mini App (WebApp)** + **Bot**
  - Bot: –≤—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞, –º–µ–Ω—é, deep-links, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  - Mini App: –æ—Å–Ω–æ–≤–Ω–æ–π UI (—Ä—ã–Ω–æ–∫, –ø–æ—Ä—Ç—Ñ–µ–ª—å, –¥–µ–ø–æ–∑–∏—Ç, —Å–¥–µ–ª–∫–∏)

### Backend
- **–Ø–∑—ã–∫**: Python 3.12
- **API**: FastAPI
- **–ë–æ—Ç**: aiogram

### –î–∞–Ω–Ω—ã–µ
- **–ë–î (MVP)**: SQLite
- **ORM**: SQLAlchemy 2
- **–ú–∏–≥—Ä–∞—Ü–∏–∏**: Alembic
- **–î–∞–ª—å—à–µ (–ø–æ—Å–ª–µ MVP)**: –ø–µ—Ä–µ–µ–∑–¥ –Ω–∞ Postgres –±–µ–∑ —Å–º–µ–Ω—ã –º–æ–¥–µ–ª–µ–π/—Å–ª–æ—ë–≤

### Frontend (Mini App)
- **UI**: HTML + Tailwind (CDN)
- **–õ–æ–≥–∏–∫–∞**: vanilla JS
- –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –±–µ–∑ React/Vue –Ω–∞ MVP, —á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏ —É—Å–∫–æ—Ä–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≥–∏–ø–æ—Ç–µ–∑—ã.

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **Telegram WebApp initData**: backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å `initData` –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### –ü–ª–∞—Ç–µ–∂–∏ (–¥–µ–ø–æ–∑–∏—Ç—ã –≤ —Å–µ—Ç–∏ TON)
- **–ê–∫—Ç–∏–≤—ã**: TON –∏ USDT (jetton) –≤ —Å–µ—Ç–∏ TON
- **–ú–æ–¥–µ–ª—å (MVP, KISS)**: **–∫–∞—Å—Ç–æ–¥–∏–∞–ª—å–Ω–∞—è**
  - –¥–µ–ø–æ–∑–∏—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞ **–∫–æ—à–µ–ª—ë–∫ –ø—Ä–æ–µ–∫—Ç–∞**
  - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- **–ê—Ç—Ä–∏–±—É—Ü–∏—è –¥–µ–ø–æ–∑–∏—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (MVP)**:
  - **–æ–¥–∏–Ω –∫–æ—à–µ–ª—ë–∫ –ø—Ä–æ–µ–∫—Ç–∞** + **—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π/–ø—ç–π–ª–æ–∞–¥** (memo) –≤ –ø–µ—Ä–µ–≤–æ–¥–µ
- **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–æ–∑–∂–µ**:
  - **—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç–Ω—ã–π –∞–¥—Ä–µ—Å** –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —É–ª—É—á—à–∏—Ç—å UX/–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è)

---

## –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (KISS)

### –ü—Ä–∞–≤–∏–ª–∞ MVP
- **–§–æ–∫—É—Å**: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø—Ä–æ—Å –Ω–∞ ‚Äú—Ñ—å—é—á–µ—Ä—Å—ã –Ω–∞ –ø–æ–¥–∞—Ä–∫–∏‚Äù –∏ –±–∞–∑–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–æ—Ç–æ–∫ (–¥–µ–ø–æ–∑–∏—Ç ‚Üí —Å–¥–µ–ª–∫–∏ ‚Üí –ø–æ—Ä—Ç—Ñ–µ–ª—å).
- **–†—ã–Ω–∫–∏**: **–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥–∞—Ä–∫–æ–≤** (–Ω–∞–±–æ—Ä –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –∏ —Ä—É—á–Ω–æ–π –Ω–∞ —Å—Ç–∞—Ä—Ç–µ).
- **–≠–∫—Å–ø–∏—Ä–∞—Ü–∏–∏**: **—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–±–æ—Ä** (–Ω–∞–ø—Ä–∏–º–µ—Ä 7 –∏ 30 –¥–Ω–µ–π).
- **–ë–µ–∑ –æ–≤–µ—Ä–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–∞**: —Å–Ω–∞—á–∞–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –±–∞–ª–∞–Ω—Å–æ–≤/—É—á—ë—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–π, –ø–æ—Ç–æ–º —Å–ª–æ–∂–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏.

### –¢–æ—Ä–≥–æ–≤–∞—è –º–æ–¥–µ–ª—å
- **TBD**: –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–æ–∑–∂–µ –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ–º—É —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é (–Ω–µ —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Å–µ–π—á–∞—Å, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–∏–Ω—è—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ).

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- **–û–¥–∏–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (monorepo)**:
  - `backend/` ‚Äî FastAPI (API) + —Å–ª—É–∂–µ–±–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–µ–ø–æ–∑–∏—Ç–æ–≤), –æ–±—â–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
  - `bot/` ‚Äî aiogram –±–æ—Ç (–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –≤ —á–∞—Ç–µ, —Å—Å—ã–ª–∫–∏/–∫–Ω–æ–ø–∫–∏ –Ω–∞ Mini App, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
  - `webapp/` ‚Äî Telegram Mini App (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ—Ä–æ–Ω—Ç)

### –ó–∞–ø—É—Å–∫ (MVP)
- **–î–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞**:
  - `api` (FastAPI)
  - `bot` (aiogram)
  
–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –¥–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–æ—â–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∏ –Ω–∞–±–ª—é–¥–∞—Ç—å (–ª–æ–≥–∏/—Ä–µ—Å—Ç–∞—Ä—Ç—ã), –¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ —á—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º ‚Äú–≤—Å—ë –≤ –æ–¥–Ω–æ–º‚Äù.

### API —Å—Ç–∏–ª—å (–¥–ª—è Mini App)
- **REST + JSON**: –Ω–µ–±–æ–ª—å—à–æ–π –Ω–∞–±–æ—Ä –ø—Ä–æ—Å—Ç—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (–±–µ–∑ GraphQL/RPC-—Å–ª–æ—ë–≤ –Ω–∞ MVP).

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (MVP)
- **Mini App (webapp)**: UI, —Ö–æ–¥–∏—Ç –≤ backend –ø–æ REST+JSON, –ø–µ—Ä–µ–¥–∞—ë—Ç `initData`.
- **Backend API (FastAPI)**:
  - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `initData`, –≤—ã–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ (—Ä—ã–Ω–æ–∫/–ø–æ—Ä—Ç—Ñ–µ–ª—å/–¥–µ–ø–æ–∑–∏—Ç-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏),
  - –≤–µ–¥—ë—Ç —É—á—ë—Ç –±–∞–ª–∞–Ω—Å–æ–≤ –∏ –æ–ø–µ—Ä–∞—Ü–∏–π,
  - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–µ–±—Ö—É–∫–∏ –ø–æ –¥–µ–ø–æ–∑–∏—Ç–∞–º.
- **Bot (aiogram)**: –∑–∞–ø—É—Å–∫ Mini App, –∫–æ–º–∞–Ω–¥—ã, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
- **TON webhook endpoint (–≤ API)**: –≤—Ö–æ–¥ –¥–ª—è —Å–æ–±—ã—Ç–∏–π –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ TON API (–¥–µ–ø–æ–∑–∏—Ç—ã TON/USDT).

### –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (KISS)
- **–ë–µ–∑ –±—Ä–æ–∫–µ—Ä–∞ –æ—á–µ—Ä–µ–¥–µ–π** (Redis/RabbitMQ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞ MVP).
- –ï—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á—ë—Ç/–ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π scheduler/async-task –≤–Ω—É—Ç—Ä–∏ API (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ).

### –ü–æ—Ç–æ–∫ –¥–µ–ø–æ–∑–∏—Ç–∞ (TON/USDT)
- –ü—Ä–æ–≤–∞–π–¥–µ—Ä TON API –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **webhook** –Ω–∞ –Ω–∞—à API.
- API –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ, —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ comment/payload), –¥–µ–ª–∞–µ—Ç –∑–∞–ø–∏—Å—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å.

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (Mermaid)

**1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã**

```mermaid
flowchart TB
    subgraph Telegram["Telegram"]
        User[üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å]
        Bot[ü§ñ Bot (aiogram)]
        MiniApp[üì± Mini App / WebApp]
    end

    subgraph Our["–ù–∞—à–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞"]
        API[Backend API\nFastAPI]
        DB[(SQLite)]
    end

    subgraph External["–í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã"]
        TON[TON API\n–ø—Ä–æ–≤–∞–π–¥–µ—Ä]
        TON_Network[–°–µ—Ç—å TON\n–∫–æ—à–µ–ª—ë–∫ –ø—Ä–æ–µ–∫—Ç–∞]
    end

    User -->|/start, –∫–Ω–æ–ø–∫–∏| Bot
    Bot -->|—Å—Å—ã–ª–∫–∞| MiniApp
    User -->|–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç| MiniApp

    MiniApp -->|REST + JSON\ninitData ‚Üí JWT\nBearer token| API
    API --> DB

    User -->|TON/USDT + comment| TON_Network
    TON_Network --> TON
    TON -->|webhook\n—Å–æ–±—ã—Ç–∏—è –¥–µ–ø–æ–∑–∏—Ç–æ–≤| API
```

**2. –û–Ω–±–æ—Ä–¥–∏–Ω–≥: –ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –≤ Mini App**

```mermaid
sequenceDiagram
    participant U as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant Bot as Bot
    participant App as Mini App
    participant API as Backend API
    participant DB as SQLite

    U->>Bot: /start
    Bot->>U: –ö–Ω–æ–ø–∫–∞ ¬´–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ¬ª
    U->>App: –û—Ç–∫—Ä—ã–≤–∞–µ—Ç Mini App (–≤ Telegram)

    App->>App: Telegram –ø–µ—Ä–µ–¥–∞—ë—Ç initData
    App->>API: POST /auth (initData)
    API->>API: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ initData
    API->>DB: –°–æ–∑–¥–∞—Ç—å/–Ω–∞–π—Ç–∏ user –ø–æ telegram_user_id
    API->>App: JWT (Bearer token)

    Note over App: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç JWT
    App->>API: GET /me, GET /markets (Authorization: Bearer &lt;JWT&gt;)
    API->>App: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ä—ã–Ω–∫–∏
    App->>U: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç UI (—Ä—ã–Ω–æ–∫, –ø–æ—Ä—Ç—Ñ–µ–ª—å)
```

**3. –î–µ–ø–æ–∑–∏—Ç TON/USDT**

```mermaid
sequenceDiagram
    participant U as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant App as Mini App
    participant API as Backend API
    participant DB as SQLite
    participant TON as TON API
    participant Wallet as –ö–æ—à–µ–ª—ë–∫ –ø—Ä–æ–µ–∫—Ç–∞

    U->>App: –ó–∞–ø—Ä–æ—Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–µ–ø–æ–∑–∏—Ç–∞
    App->>API: GET /me/deposit-instruction (Bearer JWT)
    API->>DB: user, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π comment
    API->>App: –ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ + comment (payload)
    App->>U: –ü–æ–∫–∞–∑–∞—Ç—å –∞–¥—Ä–µ—Å –∏ comment –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞

    U->>Wallet: –ü–µ—Ä–µ–≤–æ–¥ TON/USDT —Å comment
    Wallet->>TON: –°–æ–±—ã—Ç–∏–µ –≤ —Å–µ—Ç–∏ TON
    TON->>API: Webhook (tx_hash, amount, comment, ‚Ä¶)
    API->>API: –í–∞–ª–∏–¥–∞—Ü–∏—è, –ø–æ–∏—Å–∫ user –ø–æ comment
    API->>DB: deposits, ledger_entries, –æ–±–Ω–æ–≤–∏—Ç—å balances
    API->>TON: 200 OK
```

**4. –ü—Ä–æ—Ü–µ—Å—Å—ã –∏ –¥–µ–ø–ª–æ–π (MVP)**

```mermaid
flowchart LR
    subgraph Host["–õ–æ–∫–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ / —Ö–æ—Å—Ç"]
        API_Process[–ü—Ä–æ—Ü–µ—Å—Å API\n:8000]
        Bot_Process[–ü—Ä–æ—Ü–µ—Å—Å Bot\n:8081 webhook]
    end

    Tunnel[–¢—É–Ω–Ω–µ–ª—å\nngrok –∏–ª–∏ –¥—Ä—É–≥–æ–π]
    Telegram_Cloud[Telegram]
    TON_Provider[TON API]

    Telegram_Cloud -->|HTTPS webhook| Tunnel
    TON_Provider -->|HTTPS webhook| Tunnel
    Tunnel --> API_Process
    Tunnel --> Bot_Process
```

---

## –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

–¶–µ–ª—å –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö ‚Äî **–Ω–∞–¥—ë–∂–Ω—ã–π —É—á—ë—Ç –¥–µ–Ω–µ–≥ –∏ –ø–æ–∑–∏—Ü–∏–π** –ø—Ä–∏ –º–∏–Ω–∏–º—É–º–µ —Ç–∞–±–ª–∏—Ü.

### –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
- `users`
  - `id`
  - `telegram_user_id` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
  - `created_at`
- `gifts`
  - `id`
  - `name`
  - `is_active`
- `expiries`
  - `id`
  - `days` (–Ω–∞–ø—Ä–∏–º–µ—Ä 7, 30)
  - `settlement_at` (–¥–∞—Ç–∞/–≤—Ä–µ–º—è —Ä–∞—Å—á—ë—Ç–∞)
  - `is_active`
- `markets`
  - `id`
  - `gift_id`
  - `expiry_id`
  - `is_active`

### –ë–∞–ª–∞–Ω—Å—ã –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–¥–µ–Ω–µ–∂–Ω—ã–π —É—á—ë—Ç)
- `balances`
  - `id`
  - `user_id`
  - `currency` (`TON` | `USDT`)
  - `available` (Decimal)
  - `reserved` (Decimal, –º–æ–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å 0 –Ω–∞ MVP –µ—Å–ª–∏ –Ω–µ—Ç —Ä–µ–∑–µ—Ä–≤–∞)
- `ledger_entries`
  - `id`
  - `user_id`
  - `currency` (`TON` | `USDT`)
  - `delta` (Decimal, + –∏–ª–∏ -)
  - `reason` (–Ω–∞–ø—Ä–∏–º–µ—Ä `deposit`, `trade`, `withdraw`, `adjustment`)
  - `ref_type` / `ref_id` (—Å—Å—ã–ª–∫–∞ –Ω–∞ –¥–µ–ø–æ–∑–∏—Ç/—Å–¥–µ–ª–∫—É –∏ —Ç.–ø.)
  - `created_at`

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: `ledger_entries` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è –∞—É–¥–∏—Ç–∞. `balances` –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∏–∑ ledger —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ.

### –î–µ–ø–æ–∑–∏—Ç—ã (TON/USDT)
- `deposits`
  - `id`
  - `user_id`
  - `currency` (`TON` | `USDT`)
  - `amount` (Decimal)
  - `tx_hash` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
  - `comment_payload` (—Ç–æ, –ø–æ —á–µ–º—É —Å–æ–ø–æ—Å—Ç–∞–≤–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  - `status` (`received` | `credited` | `rejected`)
  - `received_at`

### –¢–æ—Ä–≥–æ–≤–ª—è (–ø–æ–∫–∞ –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–æ–π –º–æ–¥–µ–ª–∏)
- `positions`
  - `id`
  - `user_id`
  - `market_id`
  - `side` (`long` | `short`)
  - `qty` (Decimal)
  - `avg_price` (Decimal)
  - `updated_at`
- `trades`
  - `id`
  - `user_id`
  - `market_id`
  - `side` (`buy` | `sell`)
  - `qty` (Decimal)
  - `price` (Decimal)
  - `fee_currency` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - `fee_amount` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - `created_at`

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ `price`/PNL –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–æ–π –º–æ–¥–µ–ª–∏ (TBD), –Ω–æ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —É—á—ë—Ç–∞ long/short —É–∂–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã.

### –§–∏–∫—Å–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (–∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã)

–î–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª ‚Äî **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è** –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö MVP. –ö–æ–¥ (SQLAlchemy, –º–∏–≥—Ä–∞—Ü–∏–∏) –∏ API –¥–æ–ª–∂–Ω—ã –µ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å.

**–°–≤—è–∑–∏ –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏:**
- `markets` ‚Üí `gifts`, `expiries` (–æ–¥–∏–Ω —Ä—ã–Ω–æ–∫ = –æ–¥–∏–Ω –ø–æ–¥–∞—Ä–æ–∫ + –æ–¥–∏–Ω —Å—Ä–æ–∫ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏).
- `balances`, `ledger_entries`, `deposits`, `positions`, `trades` ‚Üí `users`.
- `positions`, `trades` ‚Üí `markets`.
- `ledger_entries.ref_type` / `ref_id` ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –¥–µ–ø–æ–∑–∏—Ç, —Å–¥–µ–ª–∫—É –∏ —Ç.–ø.

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (ER-–¥–∏–∞–≥—Ä–∞–º–º–∞)**

```mermaid
erDiagram
    users ||--o{ balances : has
    users ||--o{ ledger_entries : has
    users ||--o{ deposits : has
    users ||--o{ positions : has
    users ||--o{ trades : has

    gifts ||--o{ markets : "gift_id"
    expiries ||--o{ markets : "expiry_id"
    markets ||--o{ positions : has
    markets ||--o{ trades : has

    users {
        int id PK
        string telegram_user_id UK
        datetime created_at
    }
    gifts {
        int id PK
        string name
        bool is_active
    }
    expiries {
        int id PK
        int days
        datetime settlement_at
        bool is_active
    }
    markets {
        int id PK
        int gift_id FK
        int expiry_id FK
        bool is_active
    }
    balances {
        int id PK
        int user_id FK
        enum currency "TON|USDT"
        decimal available
        decimal reserved
    }
    ledger_entries {
        int id PK
        int user_id FK
        enum currency "TON|USDT"
        decimal delta
        string reason
        string ref_type
        int ref_id
        datetime created_at
    }
    deposits {
        int id PK
        int user_id FK
        enum currency "TON|USDT"
        decimal amount
        string tx_hash UK
        string comment_payload
        enum status "received|credited|rejected"
        datetime received_at
    }
    positions {
        int id PK
        int user_id FK
        int market_id FK
        enum side "long|short"
        decimal qty
        decimal avg_price
        datetime updated_at
    }
    trades {
        int id PK
        int user_id FK
        int market_id FK
        enum side "buy|sell"
        decimal qty
        decimal price
        string fee_currency
        decimal fee_amount
        datetime created_at
    }
```

**–¢–∏–ø—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–∫—Ä–∞—Ç–∫–æ):**
- –í—Å–µ `id` ‚Äî –ø–µ—Ä–≤–∏—á–Ω—ã–µ –∫–ª—é—á–∏, –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç.
- `Decimal` ‚Äî –¥–ª—è –¥–µ–Ω–µ–∂–Ω—ã—Ö –∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö –≤–µ–ª–∏—á–∏–Ω (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å, –±–µ–∑ float).
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏: `users.telegram_user_id`, `deposits.tx_hash`.
- –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏: –≤–µ–∑–¥–µ –∫–∞—Å–∫–∞–¥/–ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é; —É–¥–∞–ª–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –Ω–µ –∫–∞—Å–∫–∞–¥–∏—Ä—É–µ—Ç –Ω–∞ –±–∞–ª–∞–Ω—Å—ã/—Å–¥–µ–ª–∫–∏ –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.
- –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è (`currency`, `reason`, `status`, `side`) ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –∑–Ω–∞—á–µ–Ω–∏–π –≤ –∫–æ–¥–µ –∏ –≤ –ë–î (CHECK –∏–ª–∏ enum –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º –¥–≤–∏–∂–∫–∞).

---

## –†–∞–±–æ—Ç–∞ —Å Telegram App (Mini App + Bot)

### Mini App ‚Üí Backend (auth)
- –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏–∑ Mini App —Å–æ–¥–µ—Ä–∂–∏—Ç `initData`.
- Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å `initData`, —Å–æ–∑–¥–∞—ë—Ç/–Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—ã–¥–∞—ë—Ç **–∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–π JWT** (–Ω–∞–ø—Ä–∏–º–µ—Ä 1‚Äì6 —á–∞—Å–æ–≤).
- –î–∞–ª—å—à–µ Mini App —Ö–æ–¥–∏—Ç –≤ API —Å `Authorization: Bearer <jwt>`.

### Bot (–ø–æ–ª—É—á–µ–Ω–∏–µ –∞–ø–¥–µ–π—Ç–æ–≤)
- **Webhook**: –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –∞–ø–¥–µ–π—Ç—ã —á–µ—Ä–µ–∑ HTTPS webhook.
- –ë–æ—Ç –æ—Ç–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫–Ω–æ–ø–∫—É/—Å—Å—ã–ª–∫—É –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è Mini App –∏ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### MVP (KISS)

**–ü—Ä–∏–Ω—Ü–∏–ø:** –º–æ–Ω–∏—Ç–æ—Ä–∏–º —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ (–±–µ–∑ Prometheus, Grafana, Sentry –Ω–∞ —Å—Ç–∞—Ä—Ç–µ). –û—Å–Ω–æ–≤–∞ ‚Äî **–ª–æ–≥–∏** + **healthcheck-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**; –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ ‚Äî –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –ø—Ä–æ—Å—Ç—ã–º –≤–Ω–µ—à–Ω–∏–º –ø–∏–Ω–≥–æ–º.

**–ß—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–º:**
- **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** ‚Äî API –∏ –±–æ—Ç –æ—Ç–≤–µ—á–∞—é—Ç, webhook-—Ä–æ—É—Ç—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç –∑–∞–ø—Ä–æ—Å—ã.
- **–û—à–∏–±–∫–∏** ‚Äî –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–ª–æ–≥–∏ —Å —É—Ä–æ–≤–Ω–µ–º error + stacktrace).
- **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è** ‚Äî –¥–µ–ø–æ–∑–∏—Ç—ã (tx_hash, –∞—Ç—Ä–∏–±—É—Ü–∏—è, –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ), –≤—ã–≤–æ–¥—ã, –∞–¥–º–∏–Ω-–¥–µ–π—Å—Ç–≤–∏—è (–≤—Å—ë –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–æ –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–§–æ—Ä–º–∞—Ç –≤–µ–¥–µ–Ω–∏—è –ª–æ–≥–æ–≤¬ª).

**–ö–∞–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–º:**

1. **Healthchecks (–ø—Ä–æ–≤–µ—Ä–∫–∞ ¬´–∂–∏–≤ –ª–∏ —Å–µ—Ä–≤–∏—Å¬ª):**
   - **API**: `GET /healthz` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î –≤–Ω—É—Ç—Ä–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞.
   - **–ë–æ—Ç**: –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å—Ç–æ–π healthcheck ‚Äî –ª–∏–±–æ HTTP endpoint –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä `GET /healthz` –Ω–∞ –ø–æ—Ä—Ç—É –±–æ—Ç–∞), –ª–∏–±–æ ¬´—Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞¬ª –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ/–ø–æ –∫–æ–º–∞–Ω–¥–µ (–ª–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ webhook –∏–ª–∏ –ø–µ—Ä–≤–æ–≥–æ polling).
   - **Webhook-—Ä–æ—É—Ç—ã API**: —Å—á–∏—Ç–∞—é—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏, –µ—Å–ª–∏ API –≤ —Ü–µ–ª–æ–º –¥–æ—Å—Ç—É–ø–µ–Ω (–æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –Ω–µ –¥–µ–ª–∞–µ–º; –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤).

2. **–õ–æ–≥–∏** ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–µ—Ç–∞–ª–µ–π –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º, –æ—à–∏–±–∫–∞–º –∏ —Å–æ–±—ã—Ç–∏—è–º. –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –ø–∏—à—É—Ç JSON-–ª–æ–≥–∏ –ø–æ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É (—Å–º. —Ä–∞–∑–¥–µ–ª ¬´–§–æ—Ä–º–∞—Ç –≤–µ–¥–µ–Ω–∏—è –ª–æ–≥–æ–≤¬ª). –ü–æ –Ω–∏–º —Å–º–æ—Ç—Ä–∏–º:
   - –æ—à–∏–±–∫–∏ –∏ stacktrace;
   - –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API, –∫–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤;
   - –ø—Ä–∏—Ö–æ–¥ TON webhook –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏;
   - –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (auth, –¥–µ–ø–æ–∑–∏—Ç, –≤—ã–≤–æ–¥) ‚Äî –±–µ–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏–∑–≤–Ω–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
   - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å –Ω–∞ `GET /healthz` API (cron, –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π uptime-—Å–µ—Ä–≤–∏—Å –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç) ‚Äî —á—Ç–æ–±—ã –∑–Ω–∞—Ç—å, —á—Ç–æ —Ö–æ—Å—Ç–∏–Ω–≥ –∏ –ø—Ä–æ—Ü–µ—Å—Å –∂–∏–≤—ã.
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–∞–¥–µ–Ω–∏–∏ (email, Telegram) ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π –∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å–ø–æ—Å–æ–±, –±–µ–∑ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Ç—è–∂—ë–ª–æ–≥–æ —Å—Ç–µ–∫–∞.

**–ß–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º –Ω–∞ MVP:**
- –ù–µ –ø–æ–¥–Ω–∏–º–∞–µ–º Prometheus, Grafana, Sentry.
- –ù–µ –¥–µ–ª–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏ (—Å—á—ë—Ç—á–∏–∫–∏, –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã) ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–æ–≥–æ–≤ –∏ healthcheck.
- –ù–µ —Å—Ç—Ä–æ–∏–º –¥–∞—à–±–æ—Ä–¥—ã ‚Äî –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª–µ/–∫–æ–Ω—Å–æ–ª–∏ –∏–ª–∏ –≤ –ø—Ä–æ—Å—Ç–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ `request_id` –∏–ª–∏ `tx_hash`).

**–ö–æ–≥–¥–∞ –≤—ã—Ä–∞—Å—Ç–µ–º –∏–∑ MVP:** –ø—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ SLA –º–æ–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏ (Prometheus), –∞–ª–µ—Ä—Ç—ã –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ Sentry –¥–ª—è —Ç—Ä–µ–π—Å–æ–≤ –æ—à–∏–±–æ–∫; —Ç–µ–∫—É—â–∏–µ –ª–æ–≥–∏ –∏ healthcheck –æ—Å—Ç–∞–Ω—É—Ç—Å—è –æ—Å–Ω–æ–≤–æ–π.

---

## –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã (MVP)

### 1) –û–Ω–±–æ—Ä–¥–∏–Ω–≥
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞ ‚Üí –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É ‚Äú–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ‚Äù.
- Mini App –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏ –¥–µ–ª–∞–µ—Ç –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤ API —Å `initData` ‚Üí –ø–æ–ª—É—á–∞–µ—Ç JWT.

### 2) –î–µ–ø–æ–∑–∏—Ç TON/USDT (TON network)
- Mini App –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é **–∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞** –∏ **—É–Ω–∏–∫–∞–ª—å–Ω—ã–π comment/payload** –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç TON –∏–ª–∏ USDT (jetton) —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º comment/payload.
- –ü—Ä–æ–≤–∞–π–¥–µ—Ä TON API —à–ª—ë—Ç webhook ‚Üí API —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å `deposits` –∏ –¥–µ–ª–∞–µ—Ç `ledger_entries` ‚Üí —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `balances.available`.

### 3) –¢–æ—Ä–≥–æ–≤–ª—è (–±–µ–∑ —Ñ–∏–∫—Å–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤–æ–π –º–æ–¥–µ–ª–∏)
- Mini App –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä—ã–Ω–∫–∏ `(gift, expiry)` –∏ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç **long** –∏–ª–∏ **short** –ø–æ–∑–∏—Ü–∏—é (–¥–µ—Ç–∞–ª–∏ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è/–∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è ‚Äî TBD).
- API –ø–∏—à–µ—Ç `trades`, –æ–±–Ω–æ–≤–ª—è–µ—Ç `positions`, –æ—Ç—Ä–∞–∂–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `ledger_entries`/–±–∞–ª–∞–Ω—Å–∞—Ö (–∫–æ–º–∏—Å—Å–∏—è/—Å–ø–∏—Å–∞–Ω–∏—è ‚Äî –ø–æ –±—É–¥—É—â–µ–π –º–æ–¥–µ–ª–∏).

### 4) –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ (withdraw) ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç –∑–∞—è–≤–∫—É –Ω–∞ –≤—ã–≤–æ–¥ (amount + destination TON address).
- API –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å, —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å `withdrawals`, –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç on-chain —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å –∫–æ—à–µ–ª—å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç `tx_hash`.
- –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–µ—Ç–∏ API –ø–æ–º–µ—á–∞–µ—Ç –≤—ã–≤–æ–¥ –∫–∞–∫ `completed` –∏ –¥–µ–ª–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å –≤ `ledger_entries`.

### 5) –ê–¥–º–∏–Ω–∫–∞ (KISS)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ **–∞–¥–º–∏–Ω REST-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**, –∑–∞–∫—Ä—ã—Ç—ã–µ –æ—Ç–¥–µ–ª—å–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º:
  - –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å `gifts`, `expiries`, `markets`
  - –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–æ–≤ (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, —Å –∑–∞–ø–∏—Å—å—é –≤ `ledger_entries`)

---

## –ë–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏–∏ (–ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞)

–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è: –∞–∫—Ç–æ—Ä—ã, —Ü–µ–ª–∏, —à–∞–≥–∏, –ø–æ—Å—Ç—É—Å–ª–æ–≤–∏—è, –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –∏ –≥—Ä–∞–Ω–∏—Ü—ã MVP. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –æ—Å–Ω–æ–≤–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API –∏ –¥–æ—Ä–∞–±–æ—Ç–æ–∫.

### –ê–∫—Ç–æ—Ä—ã

| –ê–∫—Ç–æ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ö–∞–Ω–∞–ª |
|-------|----------|--------|
| **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram, —Ç–æ—Ä–≥—É–µ—Ç —Ñ—å—é—á–µ—Ä—Å–∞–º–∏ –Ω–∞ –ø–æ–¥–∞—Ä–∫–∏ | Mini App (—á–µ—Ä–µ–∑ –±–æ—Ç–∞), –±–æ—Ç (–∫–Ω–æ–ø–∫–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è) |
| **–ê–¥–º–∏–Ω** | –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞–º–∏ | REST API (–∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <ADMIN_TOKEN>`) |
| **–°–∏—Å—Ç–µ–º–∞** | TON API –ø—Ä–æ–≤–∞–π–¥–µ—Ä, webhook'–∏ | REST API (TON webhook endpoint) |

### –§–æ—Ä–º–∞—Ç –æ–ø–∏—Å–∞–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è —Ñ–∏–∫—Å–∏—Ä—É–µ–º:
- **–¶–µ–ª—å** ‚Äî —á—Ç–æ —Ö–æ—á–µ—Ç –¥–æ—Å—Ç–∏—á—å –∞–∫—Ç–æ—Ä.
- **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è** ‚Äî —á—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏—Å—Ç–∏–Ω–Ω–æ –¥–æ –Ω–∞—á–∞–ª–∞.
- **–®–∞–≥–∏** ‚Äî –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π (–∞–∫—Ç–æ—Ä + —Å–∏—Å—Ç–µ–º–∞).
- **–ü–æ—Å—Ç—É—Å–ª–æ–≤–∏—è** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –∏ –æ—à–∏–±–∫–∏** ‚Äî –≤–µ—Ç–≤–ª–µ–Ω–∏—è, –æ—Ç–∫–∞—Ç—ã, —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
- **MVP / –ø–æ–∑–∂–µ** ‚Äî —á—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ MVP, —á—Ç–æ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–Ω–±–æ—Ä–¥–∏–Ω–≥ (–ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –≤ Mini App)

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| **–¶–µ–ª—å** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ Mini App –∏ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å API –ø–æ–¥ —Å–≤–æ–µ–π —É—á—ë—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é. |
| **–ê–∫—Ç–æ—Ä** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. |
| **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–ª –±–æ—Ç–∞ –≤ Telegram; –±–æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω (WEBAPP_URL, WEBHOOK –∏ —Ç.–¥.). |
| **–®–∞–≥–∏** | 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç ¬´–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ¬ª –≤ –±–æ—Ç–µ. 2. Telegram –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Mini App –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –≤ –Ω–µ—ë `initData`. 3. Mini App –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ API `POST /auth/telegram` —Å —Ç–µ–ª–æ–º `{ "init_data": "<initData>" }`. 4. API –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å `initData`, –∏–∑–≤–ª–µ–∫–∞–µ—Ç `user.id` (telegram_user_id), —Å–æ–∑–¥–∞—ë—Ç –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–ø–∏—Å—å –≤ `users`, –≤—ã–¥–∞—ë—Ç JWT. 5. Mini App —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç JWT –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <jwt>` –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. |
| **–ü–æ—Å—Ç—É—Å–ª–æ–≤–∏—è** | –í –ë–î –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –¥–∞–Ω–Ω—ã–º `telegram_user_id`; —É –∫–ª–∏–µ–Ω—Ç–∞ –µ—Å—Ç—å –¥–µ–π—Å—Ç–≤—É—é—â–∏–π JWT; –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã. |
| **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã** | **A1.** –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –∏–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π `initData` ‚Üí API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401, Mini App –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ–π—Ç–∏¬ª. **A2.** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `user` –≤ `initData` ‚Üí 400, —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ. |
| **MVP / –ø–æ–∑–∂–µ** | MVP: —Ç–æ–ª—å–∫–æ –≤—Ö–æ–¥ –ø–æ initData –∏ –≤—ã–¥–∞—á–∞ JWT. –ü–æ–∑–∂–µ: refresh token, —è–≤–Ω—ã–π ¬´–í—ã–π—Ç–∏¬ª, –ø—Ä–∏–≤—è–∑–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤. |

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –î–µ–ø–æ–∑–∏—Ç TON/USDT

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| **–¶–µ–ª—å** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–æ–ª–Ω—è–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å (TON –∏–ª–∏ USDT), –ø–µ—Ä–µ–≤–æ–¥—è —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ –∫–æ—à–µ–ª—ë–∫ –ø—Ä–æ–µ–∫—Ç–∞ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º comment. |
| **–ê–∫—Ç–æ—Ä** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Å–∏—Å—Ç–µ–º–∞ (TON API –ø—Ä–æ–≤–∞–π–¥–µ—Ä). |
| **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω (JWT); —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–æ–∑–∏—Ç—É (–∞–¥—Ä–µ—Å + comment). |
| **–®–∞–≥–∏** | 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ Mini App –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–µ–ø–æ–∑–∏—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä `GET /me/deposit-instruction`). 2. API –ø–æ JWT –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç user_id, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π comment (payload) –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/—Å–µ—Å—Å–∏–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ comment. 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –∫–æ—à–µ–ª—å–∫–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç TON –∏–ª–∏ USDT (jetton) –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º comment. 4. –ü—Ä–æ–≤–∞–π–¥–µ—Ä TON API —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –Ω–∞ –Ω–∞—à API (–Ω–∞–ø—Ä–∏–º–µ—Ä `POST /ton/webhook`) —Å –¥–∞–Ω–Ω—ã–º–∏ (tx_hash, amount, comment, currency –∏ —Ç.–¥.). 5. API –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç webhook (—Å–µ–∫—Ä–µ—Ç, –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ tx_hash), –ø–æ comment –Ω–∞—Ö–æ–¥–∏—Ç user_id, —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ `deposits` (status `received` ‚Üí `credited`), –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ `ledger_entries`, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `balances.available` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. 6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å (–ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —ç–∫—Ä–∞–Ω–∞). |
| **–ü–æ—Å—Ç—É—Å–ª–æ–≤–∏—è** | –í `deposits` –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å —Å status `credited`; –≤ `ledger_entries` –∑–∞–ø–∏—Å—å —Å reason `deposit`; —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–≤–µ–ª–∏—á–µ–Ω `balances.available` –Ω–∞ —Å—É–º–º—É –¥–µ–ø–æ–∑–∏—Ç–∞. |
| **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã** | **A1.** Comment –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ‚Üí –¥–µ–ø–æ–∑–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å–µ `rejected` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–≤–∏–∫—Å; –ª–æ–≥–∏—Ä—É–µ–º, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä—É—á–Ω–∞—è –∞—Ç—Ä–∏–±—É—Ü–∏—è –∞–¥–º–∏–Ω–æ–º. **A2.** –î—É–±–ª–∏–∫–∞—Ç `tx_hash` ‚Üí –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: –Ω–µ —Å–æ–∑–¥–∞—ë–º –≤—Ç–æ—Ä–æ–π –¥–µ–ø–æ–∑–∏—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—Ö. **A3.** –ù–µ–≤–µ—Ä–Ω—ã–π —Å–µ–∫—Ä–µ—Ç webhook ‚Üí 401, –Ω–µ –∑–∞—á–∏—Å–ª—è–µ–º. **A4.** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–≤—ë–ª –±–µ–∑ comment –∏–ª–∏ —Å –æ—à–∏–±–∫–æ–π ‚Üí –ø–æ —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏ –Ω–µ –∑–∞—á–∏—Å–ª—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏; –≤ MVP ‚Äî —Ä–∞–∑–±–æ—Ä –≤—Ä—É—á–Ω—É—é/–ø–æ–¥–¥–µ—Ä–∂–∫–∞. |
| **MVP / –ø–æ–∑–∂–µ** | MVP: –æ–¥–∏–Ω –∫–æ—à–µ–ª—ë–∫ + comment, –∞—Ç—Ä–∏–±—É—Ü–∏—è –ø–æ comment, —Ä—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ¬´–ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö¬ª –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. –ü–æ–∑–∂–µ: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç–Ω—ã–π –∞–¥—Ä–µ—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Ç—Ä–∞–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è. |

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –¢–æ—Ä–≥–æ–≤–ª—è (–æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏)

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| **–¶–µ–ª—å** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç long/short –ø–æ —Ä—ã–Ω–∫—É (gift + expiry) –∏–ª–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é; –±–∞–ª–∞–Ω—Å –∏ –ø–æ–∑–∏—Ü–∏–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º —Ç–æ—Ä–≥–æ–≤–æ–π –º–æ–¥–µ–ª–∏. |
| **–ê–∫—Ç–æ—Ä** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. |
| **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω; –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ä—ã–Ω–∫–∏; –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å –∏ –ª–∏–º–∏—Ç—ã (–ø–æ –±—É–¥—É—â–µ–π –º–æ–¥–µ–ª–∏). |
| **–®–∞–≥–∏** | 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ Mini App –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —Ä—ã–Ω–∫–∏ (—Å–ø–∏—Å–æ–∫ gift + expiry) –∏ —Å–≤–æ–∏ –ø–æ–∑–∏—Ü–∏–∏. 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ: –æ—Ç–∫—Ä—ã—Ç—å long/short –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é (–æ–±—ä—ë–º, —Ü–µ–Ω–∞ ‚Äî –ø–æ –º–æ–¥–µ–ª–∏). 3. Mini App –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ API (–Ω–∞–ø—Ä–∏–º–µ—Ä –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ / –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏). 4. API –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä—ã–Ω–æ–∫ (active), –±–∞–ª–∞–Ω—Å, –ª–∏–º–∏—Ç—ã; –ø—Ä–∏ —É—Å–ø–µ—Ö–µ —Å–æ–∑–¥–∞—ë—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç `trades`, –æ–±–Ω–æ–≤–ª—è–µ—Ç `positions`, —Å–ø–∏—Å—ã–≤–∞–µ—Ç/–Ω–∞—á–∏—Å–ª—è–µ—Ç –ø–æ `ledger_entries` –∏ `balances` (–∫–æ–º–∏—Å—Å–∏—è ‚Äî –ø–æ –º–æ–¥–µ–ª–∏). 5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∏ –±–∞–ª–∞–Ω—Å. |
| **–ü–æ—Å—Ç—É—Å–ª–æ–≤–∏—è** | –í `trades` –Ω–æ–≤–∞—è —Å–¥–µ–ª–∫–∞; –≤ `positions` –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –∏–ª–∏ –Ω–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è; –≤ `ledger_entries` –∏ `balances` –æ—Ç—Ä–∞–∂–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è. |
| **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã** | **A1.** –†—ã–Ω–æ–∫ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω ‚Üí 400, ¬´–†—ã–Ω–æ–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω¬ª. **A2.** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ ‚Üí 400, ¬´–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞¬ª. **A3.** –¢–æ—Ä–≥–æ–≤–∞—è –º–æ–¥–µ–ª—å –Ω–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–µ—Ç –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏) ‚Üí 422 –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å, —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. |
| **MVP / –ø–æ–∑–∂–µ** | MVP: —Å—Ü–µ–Ω–∞—Ä–∏–π –æ–ø–∏—Å–∞–Ω, –¥–µ—Ç–∞–ª–∏ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è ‚Äî TBD; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–≥–ª—É—à–∫–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤. –ü–æ–∑–∂–µ: –ø–æ–ª–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è –º–æ–¥–µ–ª—å, –ª–∏–º–∏—Ç–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞, —ç–∫—Å–ø–∏—Ä–∞—Ü–∏—è –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤. |

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ (withdraw)

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| **–¶–µ–ª—å** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–≤–æ–¥–∏—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π TON-–∞–¥—Ä–µ—Å. |
| **–ê–∫—Ç–æ—Ä** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. |
| **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω; –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å ‚â• —Å—É–º–º—ã –≤—ã–≤–æ–¥–∞; –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤–∞–ª–∏–¥–Ω—ã–π (TON). |
| **–®–∞–≥–∏** | 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ Mini App —É–∫–∞–∑—ã–≤–∞–µ—Ç —Å—É–º–º—É –∏ –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≤—ã–≤–æ–¥. 2. Mini App –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ API (–Ω–∞–ø—Ä–∏–º–µ—Ä `POST /me/withdraw`). 3. API –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å, —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ `withdrawals` (status `pending`), —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ (—É–º–µ–Ω—å—à–∞–µ—Ç `available`, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `reserved` –∏–ª–∏ —Å–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ä–∞–∑—É ‚Äî –ø–æ —Ä–µ—à–µ–Ω–∏—é). 4. API –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç on-chain —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å –∫–æ—à–µ–ª—å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å, –ø–æ–ª—É—á–∞–µ—Ç/—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `tx_hash`. 5. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤ —Å–µ—Ç–∏ (–∏–ª–∏ –ø–æ webhook/–ø—Ä–æ–≤–µ—Ä–∫–µ) API –ø–æ–º–µ—á–∞–µ—Ç –≤—ã–≤–æ–¥ –∫–∞–∫ `completed`, –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ `ledger_entries`, —Å–Ω–∏–º–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤/—Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–ø–∏—Å–∞–Ω–∏–µ. 6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç–∞—Ç—É—Å –≤—ã–≤–æ–¥–∞ –∏ –∏—Å—Ç–æ—Ä–∏—é. |
| **–ü–æ—Å—Ç—É—Å–ª–æ–≤–∏—è** | –í `withdrawals` –∑–∞–ø–∏—Å—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `completed`; –≤ `ledger_entries` –∑–∞–ø–∏—Å—å —Å reason `withdraw`; –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–º–µ–Ω—å—à–µ–Ω; —Å—Ä–µ–¥—Å—Ç–≤–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã on-chain. |
| **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã** | **A1.** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞ ‚Üí 400, ¬´–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤¬ª. **A2.** –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –∞–¥—Ä–µ—Å ‚Üí 400, ¬´–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å¬ª. **A3.** –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ on-chain ‚Üí withdrawal –≤ —Å—Ç–∞—Ç—É—Å–µ `failed`, —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑–µ—Ä–≤–∞, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ; –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ‚Äî ¬´–û—à–∏–±–∫–∞ –≤—ã–≤–æ–¥–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É¬ª. **A4.** –õ–∏–º–∏—Ç—ã –≤—ã–≤–æ–¥–∞ (–µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω—ã) ‚Üí 400 –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏. |
| **MVP / –ø–æ–∑–∂–µ** | MVP: –æ–¥–∏–Ω –≤—ã–≤–æ–¥ –∑–∞ —Ä–∞–∑ –∏–ª–∏ –æ—á–µ—Ä–µ–¥—å; —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å–±–æ—è—Ö. –ü–æ–∑–∂–µ: –ª–∏–º–∏—Ç—ã, KYC, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Ç—Ä–∞–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ. |

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ê–¥–º–∏–Ω ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| **–¶–µ–ª—å** | –ê–¥–º–∏–Ω –≤–∫–ª—é—á–∞–µ—Ç/–≤—ã–∫–ª—é—á–∞–µ—Ç –ø–æ–¥–∞—Ä–∫–∏, —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏, —Ä—ã–Ω–∫–∏; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∑–∞–ø–∏—Å—å—é –≤ ledger. |
| **–ê–∫—Ç–æ—Ä** | –ê–¥–º–∏–Ω. |
| **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è** | –ó–∞–ø—Ä–æ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞–ª–∏–¥–Ω—ã–π –∞–¥–º–∏–Ω-—Ç–æ–∫–µ–Ω (`ADMIN_TOKEN`). |
| **–®–∞–≥–∏** | 1. –ê–¥–º–∏–Ω –≤—ã–∑—ã–≤–∞–µ—Ç REST-—ç–Ω–¥–ø–æ–∏–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å market: `PATCH /admin/markets/{id}`, body `{ "is_active": false }`). 2. API –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫/—Ç–æ–∫–µ–Ω, –æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å (gift, expiry, market). –ò–ª–∏: –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞ ‚Äî `POST /admin/balances/adjust` —Å —É–∫–∞–∑–∞–Ω–∏–µ–º user_id, currency, delta, reason (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ). 3. API –ø–∏—à–µ—Ç –≤ `ledger_entries` –∑–∞–ø–∏—Å—å —Å reason `adjustment`, –æ–±–Ω–æ–≤–ª—è–µ—Ç `balances`. 4. –ê–¥–º–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ–± —É—Å–ø–µ—Ö–µ. |
| **–ü–æ—Å—Ç—É—Å–ª–æ–≤–∏—è** | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –æ–±–Ω–æ–≤–ª—ë–Ω (is_active –∏ —Ç.–¥.); –ø—Ä–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–µ ‚Äî –±–∞–ª–∞–Ω—Å –∏ ledger —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã. |
| **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã** | **A1.** –ù–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–æ–∫–µ–Ω ‚Üí 401. **A2.** –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏) ‚Üí 400, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î. **A3.** –ü—Ä–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–µ –ø—Ä–∏—á–∏–Ω–∞ (reason) –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ ‚Äî –∏–Ω–∞—á–µ 400; –ª–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –∞–¥–º–∏–Ω-–¥–µ–π—Å—Ç–≤–∏—è. |
| **MVP / –ø–æ–∑–∂–µ** | MVP: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (gifts, expiries, markets on/off; –æ–¥–Ω–∞ —Ñ–æ—Ä–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –±–∞–ª–∞–Ω—Å–∞). –ü–æ–∑–∂–µ: —Ä–æ–ª–∏, –∞—É–¥–∏—Ç-–ª–æ–≥ –∞–¥–º–∏–Ω–∞, –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏. |

---

### –°–≤–æ–¥–∫–∞: —á—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

- **–ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç** (—Ü–µ–ª—å, –ø—Ä–µ–¥—É—Å–ª–æ–≤–∏—è, —à–∞–≥–∏, –ø–æ—Å—Ç—É—Å–ª–æ–≤–∏—è, –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã) ‚Äî —É–¥–æ–±–Ω–æ –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –≤ —Ç–µ—Å—Ç-–∫–µ–π—Å—ã –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –ø—Ä–∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞—Ö.
- **–ê–∫—Ç–æ—Ä—ã –∏ –∫–∞–Ω–∞–ª—ã** ‚Äî —è–≤–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã; –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö (–ø–æ–¥–¥–µ—Ä–∂–∫–∞, –ø–∞—Ä—Ç–Ω—ë—Ä—ã) –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ —Ç–æ–º—É –∂–µ —à–∞–±–ª–æ–Ω—É.
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –∏ –æ—à–∏–±–∫–∏** ‚Äî —è–≤–Ω–æ –æ–ø–∏—Å–∞–Ω—ã; –ø—Ä–∏ —Ä–æ—Å—Ç–µ —Å–∏—Å—Ç–µ–º—ã —Å—é–¥–∞ –∂–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ –≤–µ—Ç–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä ¬´—á–∞—Å—Ç–∏—á–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ¬ª, ¬´–æ—á–µ—Ä–µ–¥—å –Ω–∞ –≤—ã–≤–æ–¥¬ª).
- **MVP / –ø–æ–∑–∂–µ** ‚Äî –≥—Ä–∞–Ω–∏—Ü–∞ –æ–±—ä—ë–º–∞ —Ä–∞–±–æ—Ç –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤; —É–º–µ–Ω—å—à–∞–µ—Ç —Ä–∏—Å–∫–∏ –æ–≤–µ—Ä–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–∞ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ –∏ –¥–∞—ë—Ç –ø–ª–∞–Ω —Å–ª–µ–¥—É—é—â–∏—Ö –∏—Ç–µ—Ä–∞—Ü–∏–π.

---

## –î–µ–ø–ª–æ–π

### MVP (—Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –ø—É—Ç—å)
- **–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ GitHub:** API –∏ –±–æ—Ç ‚Äî –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub (–Ω–∞–ø—Ä–∏–º–µ—Ä GitHub Actions –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥/VPS); Mini App (webapp) ‚Äî GitHub Pages (workflow —É–∂–µ –µ—Å—Ç—å). –°–µ—Ä–≤–µ—Ä –±–æ–ª—å—à–µ –Ω–µ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ Cloudflare Tunnel.
- –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏ –ø–æ –∂–µ–ª–∞–Ω–∏—é: –∑–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ + —Ç—É–Ω–Ω–µ–ª—å (ngrok –∏–ª–∏ –¥—Ä—É–≥–æ–π) –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ HTTPS (webhook Telegram, TON API).
- Mini App: —Å—Ç–∞—Ç–∏–∫–∞ –Ω–∞ GitHub Pages –ø–æ HTTPS; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî —Ä–∞–∑–¥–∞—á–∞ –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ `http.server` –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

---

## –°–±–æ—Ä–∫–∞ –∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

–ï–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Å–±–æ—Ä–∫–µ –∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é: —á—Ç–æ —Å–æ–±–∏—Ä–∞–µ–º, –≤ –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ –∑–∞–ø—É—Å–∫–∞–µ–º, –∫–∞–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ. –í–∞–∂–Ω–æ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

### –°–±–æ—Ä–∫–∞ (build)

**–¶–µ–ª—å:** –ø–æ–ª—É—á–∏—Ç—å –≥–æ—Ç–æ–≤—ã–µ –∫ –∑–∞–ø—É—Å–∫—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–∑ —Ä—É—á–Ω—ã—Ö —à–∞–≥–æ–≤ –ø–æ—Å–ª–µ `git clone`.

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ß—Ç–æ –¥–µ–ª–∞–µ–º –Ω–∞ MVP | –ü–æ–∑–∂–µ |
|-----------|-------------------|--------|
| **Backend (API)** | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: `pip install -r requirements.txt` –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏; –∫–æ–¥ –Ω–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è. –¢–∞–±–ª–∏—Ü—ã –ë–î —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ (`Base.metadata.create_all`). | Alembic-–º–∏–≥—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å–±–æ—Ä–∫–∞ –≤ Docker-–æ–±—Ä–∞–∑. |
| **Bot** | –¢–µ –∂–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–æ–±—â–∏–π `requirements.txt` –≤ –∫–æ—Ä–Ω–µ –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤ `bot/` –ø—Ä–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–∏). –ó–∞–ø—É—Å–∫: `python app/main.py` –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ `bot/`. | –û—Ç–¥–µ–ª—å–Ω—ã–π –æ–±—Ä–∞–∑/–ø—Ä–æ—Ü–µ—Å—Å –≤ Docker. |
| **Webapp (Mini App)** | –°—Ç–∞—Ç–∏–∫–∞: –∫–∞—Ç–∞–ª–æ–≥ `webapp/public/` –±–µ–∑ —Å–±–æ—Ä–∫–∏ (HTML, Tailwind CDN, vanilla JS). –†–∞–∑–¥–∞—á–∞: –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `python -m http.server 5500` –∏–ª–∏ –ª—é–±–æ–π static host. | –ü—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å–±–æ—Ä–∫–∏ (Vite/Webpack) ‚Äî —à–∞–≥ `npm run build` –∏ –¥–µ–ø–ª–æ–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞. |

**–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (MVP):** –∫–æ—Ä–Ω–µ–≤–æ–π `requirements.txt` –¥–ª—è API –∏ –±–æ—Ç–∞. Python 3.12 (—É–∫–∞–∑–∞—Ç—å –≤ README –∏–ª–∏ –≤ CI).

**–ß–µ–∫–ª–∏—Å—Ç —Å–±–æ—Ä–∫–∏ (–ª–æ–∫–∞–ª—å–Ω–æ):**
1. `python -m venv .venv` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥), –∞–∫—Ç–∏–≤–∞—Ü–∏—è.
2. `pip install -r requirements.txt`.
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `.env.example` –≤ `.env`, –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (—Å–º. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ).
4. –ó–∞–ø—É—Å–∫ ‚Äî —Å–º. –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ.

---

### –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ (deploy) MVP

**–û–∫—Ä—É–∂–µ–Ω–∏–µ:** –æ—Å–Ω–æ–≤–Ω–æ–π –¥–µ–ø–ª–æ–π ‚Äî —á–µ—Ä–µ–∑ GitHub (Actions ‚Üí —Ö–æ—Å—Ç–∏–Ω–≥/VPS; webapp ‚Üí GitHub Pages). –õ–æ–∫–∞–ª—å–Ω–æ ‚Äî –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏; –ø—É–±–ª–∏—á–Ω—ã–π HTTPS —á–µ—Ä–µ–∑ reverse proxy –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ –∏–ª–∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Ç—É–Ω–Ω–µ–ª—å (ngrok –∏ —Ç.–ø.) –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ.

**–ü—Ä–æ—Ü–µ—Å—Å—ã –∏ –ø–æ—Ä—Ç—ã:**

| –ü—Ä–æ—Ü–µ—Å—Å | –ö–æ–º–∞–Ω–¥–∞ | –ü–æ—Ä—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|---------|------|------------|
| **API** | `uvicorn app.main:app --host 0.0.0.0 --port 8000` –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ `backend/` | 8000 | REST API, healthz, TON webhook. |
| **Bot** | `python app/main.py` –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ `bot/` | 8081 (—Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ webhook: aiohttp –¥–ª—è webhook + healthz) | Telegram webhook, healthz. –í —Ä–µ–∂–∏–º–µ polling –ø–æ—Ä—Ç –Ω–µ —Å–ª—É—à–∞–µ—Ç—Å—è. |
| **Webapp** | –ù–∞ –¥–µ–ø–ª–æ–µ ‚Äî GitHub Pages (—Å—Ç–∞—Ç–∏–∫–∞ –∏–∑ `webapp/public/`). –õ–æ–∫–∞–ª—å–Ω–æ: `python -m http.server 5500` –∏–∑ `webapp/public/` | 5500 (–ª–æ–∫–∞–ª—å–Ω–æ) | –°—Ç–∞—Ç–∏–∫–∞ Mini App. |
| **–¢—É–Ω–Ω–µ–ª—å** | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏: ngrok –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç—É–Ω–Ω–µ–ª—å –Ω–∞ –Ω—É–∂–Ω—ã–π –ø–æ—Ä—Ç. | ‚Äî | –ü—É–±–ª–∏—á–Ω—ã–π HTTPS –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ; –æ—Å–Ω–æ–≤–Ω–æ–π –¥–µ–ø–ª–æ–π ‚Äî —á–µ—Ä–µ–∑ GitHub, –±–µ–∑ Cloudflare Tunnel. |

**–ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π):**
1. **API** ‚Äî –ø–µ—Ä–≤—ã–º, —á—Ç–æ–±—ã –ë–î –±—ã–ª–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∏ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ.
2. **Bot** ‚Äî –ø–æ—Å–ª–µ API, –µ—Å–ª–∏ –±–æ—Ç –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ API (–≤ MVP –º–æ–∂–µ—Ç –Ω–µ –æ–±—Ä–∞—â–∞—Ç—å—Å—è).
3. **Webapp** ‚Äî –Ω–∞ –¥–µ–ø–ª–æ–µ —á–µ—Ä–µ–∑ GitHub Pages (push –≤ `main`); –ª–æ–∫–∞–ª—å–Ω–æ ‚Äî `http.server` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
4. **–¢—É–Ω–Ω–µ–ª—å** ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–µ: –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ API/webapp —Å–ª—É—à–∞—é—Ç –ø–æ—Ä—Ç—ã; –Ω–∞ –¥–µ–ø–ª–æ–µ —á–µ—Ä–µ–∑ GitHub —Ç—É–Ω–Ω–µ–ª—å –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º.

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –¥–µ–ø–ª–æ—è:** —Å–º. —Ä–∞–∑–¥–µ–ª –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ. –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã: `BOT_TOKEN`, `WEBHOOK_BASE_URL` (–¥–ª—è webhook –±–æ—Ç–∞), `WEBAPP_URL` (URL Mini App –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤ –±–æ—Ç–µ), `JWT_SECRET`, `DATABASE_URL`. –î–ª—è TON: `TON_WEBHOOK_SECRET`, –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –∏ —Ç.–¥.

**–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (–ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫):** —Å–∫—Ä–∏–ø—Ç—ã `run-dev.ps1` (Windows) –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ `run-dev.bat` ‚Äî –∑–∞–ø—É—Å–∫–∞—é—Ç –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ —Ñ–æ–Ω–µ, –ø–∏—à—É—Ç –ª–æ–≥–∏ –≤ `logs/<run_id>/`. –û–ø—Ü–∏–∏: `-NoApi`, `-NoWeb`, `-NoTunnel`, `-NoBot` –¥–ª—è –≤—ã–±–æ—Ä–æ—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.

---

### –†–µ–ø—Ä–æ–¥—É—Ü–∏—Ä—É–µ–º–æ—Å—Ç—å

- **–û–¥–∏–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (monorepo):** backend, bot, webapp ‚Äî –≤ –æ–¥–Ω–æ–º –¥–µ—Ä–µ–≤–µ; —Å–±–æ—Ä–∫–∞ –∏ –¥–µ–ø–ª–æ–π –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (—ç—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª + README).
- **–í–µ—Ä—Å–∏–∏:** Python 3.12; –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚Äî –≤ `requirements.txt` (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏–∏ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏).
- **–°–µ–∫—Ä–µ—Ç—ã:** –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å; —Ç–æ–ª—å–∫–æ `.env.example` —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏; –Ω–∞ –¥–µ–ø–ª–æ–µ ‚Äî `.env` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ö–æ—Å—Ç–∞/CI.
- **–õ–æ–≥–∏:** –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ `run-dev.ps1` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ `logs/<run_id>/`, –ø–æ –æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å (api.log, bot.log, webapp.log, tunnel.log); —Ä–æ—Ç–∞—Ü–∏—è –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Äî –Ω–∞ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ (MVP: —Ä—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞).

---

### –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–∑–º–µ—â–µ–Ω–∏—è MVP

| –í–∞—Ä–∏–∞–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–ª—é—Å—ã / –º–∏–Ω—É—Å—ã |
|---------|----------|-----------------|
| **–î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub** | API –∏ –±–æ—Ç ‚Äî –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions (–Ω–∞ VPS –∏–ª–∏ —Ö–æ—Å—Ç–∏–Ω–≥, –ø–æ–¥–∫–ª—é—á–∞–µ–º—ã–π –∫ GitHub). Webapp ‚Äî GitHub Pages (workflow —É–∂–µ –µ—Å—Ç—å); `WEBAPP_URL` ‚Äî URL Pages. –°–µ—Ä–≤–µ—Ä –Ω–µ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ Cloudflare. | –û–¥–∏–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, CI/CD –∏–∑ –∫–æ—Ä–æ–±–∫–∏; —Å—Ç–∞—Ç–∏–∫–∞ –ø–æ HTTPS; API/–±–æ—Ç ‚Äî –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–µ. |
| **VPS –≤—Ä—É—á–Ω—É—é** | API –∏ –±–æ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (systemd/supervisor); webapp ‚Äî nginx/static –∏–ª–∏ Pages; –¥–æ–º–µ–Ω –∏ SSL (Let's Encrypt –∏ —Ç.–ø.). | –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å; –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞ –≤–∞—Å. |
| **–õ–æ–∫–∞–ª—å–Ω–æ + —Ç—É–Ω–Ω–µ–ª—å** | –¢–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏: API –∏ –±–æ—Ç –Ω–∞ —Å–≤–æ–µ–π –º–∞—à–∏–Ω–µ; webapp ‚Äî `http.server` –∏–ª–∏ Pages; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ngrok –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç—É–Ω–Ω–µ–ª—å –¥–ª—è HTTPS. | –£–¥–æ–±–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏; –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub. |

---

### –ü–æ–∑–∂–µ (–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)

- **Docker:** –æ–±—Ä–∞–∑—ã –¥–ª—è API –∏ –±–æ—Ç–∞; `docker-compose` –ø–æ–¥–Ω–∏–º–∞–µ—Ç API, –±–æ—Ç, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å–µ—Ä–≤–∏—Å —Å—Ç–∞—Ç–∏–∫–∏; –æ–¥–∏–Ω —Ñ–∞–π–ª `.env` –¥–ª—è –∫–æ–º–ø–æ–∑–∞.
- **CI/CD:** —Ç–µ—Å—Ç—ã –≤ GitHub Actions –Ω–∞ push; –¥–µ–ø–ª–æ–π API/–±–æ—Ç–∞ –Ω–∞ VPS –ø–æ —Ç–µ–≥—É –∏–ª–∏ –∏–∑ `main` (–ø–æ —Ä–µ—à–µ–Ω–∏—é); webapp ‚Äî —É–∂–µ –¥–µ–ø–ª–æ–∏—Ç—Å—è –Ω–∞ Pages.
- **–ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î:** –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º API –≤—ã–ø–æ–ª–Ω—è—Ç—å `alembic upgrade head`; –≤ MVP —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- **–†–∞–∑–¥–µ–ª—å–Ω—ã–µ URL –¥–ª—è API –∏ webapp:** –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ ‚Äî –¥–≤–∞ –¥–æ–º–µ–Ω–∞/–ø—É—Ç–∏ –∏–ª–∏ reverse proxy; `WEBHOOK_BASE_URL` –Ω–∞ API, `WEBAPP_URL` –Ω–∞ —Å—Ç–∞—Ç–∏–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä GitHub Pages).

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–∏–Ω—Ü–∏–ø—ã (KISS)

- **–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫:** –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (env). –ù–∏–∫–∞–∫–∏—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥-—Ñ–∞–π–ª–æ–≤ (yaml/json) –Ω–∞ MVP.
- **–õ–æ–∫–∞–ª—å–Ω–æ:** —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–∏–ª–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥–∞—Ö `backend/` –∏ `bot/` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏–∑ –Ω–∏—Ö). –§–∞–π–ª `.env` –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å; –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Ç–æ–ª—å–∫–æ `.env.example` —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ –∏ —Å–ø–∏—Å–∫–æ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.
- **–ù–∞ –¥–µ–ø–ª–æ–µ:** –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—é—Ç—Å—è –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏ —Ö–æ—Å—Ç–∞/CI (GitHub Secrets, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ VPS –∏ —Ç.–ø.); –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è `.env` –∏–∑ –Ω–∏—Ö –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º.
- **–û–¥–∏–Ω —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö** ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –≤ —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –∏ –≤ `.env.example`; –∫–æ–¥ (backend `settings`, bot) –¥–æ–ª–∂–µ–Ω –∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å.

---

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ .env –∏ –∑–∞–≥—Ä—É–∑–∫–∞

| –û–∫—Ä—É–∂–µ–Ω–∏–µ | –ì–¥–µ –ª–µ–∂–∏—Ç .env | –ö—Ç–æ —á–∏—Ç–∞–µ—Ç |
|-----------|----------------|------------|
| **–õ–æ–∫–∞–ª—å–Ω–æ** | –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ –∫–æ–ø–∏—è –≤ `backend/` –∏ `bot/` (–ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏–∑ —ç—Ç–∏—Ö –∫–∞—Ç–∞–ª–æ–≥–æ–≤ `load_dotenv()` –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é). | API (backend), Bot (bot) ‚Äî –∫–∞–∂–¥—ã–π –∏–∑ —Å–≤–æ–µ–π —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏. |
| **–î–µ–ø–ª–æ–π** | –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ (GitHub Actions env, systemd EnvironmentFile, –∏ —Ç.–¥.); —Ñ–∞–π–ª `.env` –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω. | API –∏ Bot –ø–æ–ª—É—á–∞—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è. |

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ø—Ä–∏ –µ–¥–∏–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ –∑–∞–ø—É—Å–∫–∞ –∏–∑ –∫–æ—Ä–Ω—è (–Ω–∞–ø—Ä–∏–º–µ—Ä `run-dev.ps1`) –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –¥–æ—á–µ—Ä–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏–∑ –æ–¥–Ω–æ–≥–æ `.env` –≤ –∫–æ—Ä–Ω–µ; –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ `uvicorn`/`python app/main.py` –∏–∑ `backend/` –∏ `bot/` ‚Äî –ø–æ–ª–æ–∂–∏—Ç—å `.env` –≤ `backend/` –∏ `bot/` –∏–ª–∏ –∑–∞–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω–∞—á–µ.

---

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ –æ–±–ª–∞—Å—Ç—è–º

**–ò—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã:** —Ç–∞–±–ª–∏—Ü–∞ –Ω–∏–∂–µ + `.env.example`. –í—Å–µ –∏–º–µ–Ω–∞ ‚Äî –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ; –∑–Ω–∞—á–µ–Ω–∏—è –±–µ–∑ –∫–∞–≤—ã—á–µ–∫ –≤ `.env` (–µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–æ–±–µ–ª–æ–≤).

#### Telegram (–±–æ—Ç –∏ Mini App)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –ö—Ç–æ —á–∏—Ç–∞–µ—Ç |
|------------|----------|----------------|--------------|------------|
| `BOT_TOKEN` | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ Telegram (BotFather). | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | ‚Äî | API (auth), Bot |
| `WEBHOOK_BASE_URL` | –ü—É–±–ª–∏—á–Ω—ã–π HTTPS-–±–∞–∑–æ–≤—ã–π URL (–Ω–∞–ø—Ä–∏–º–µ—Ä `https://api.example.com`), –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π Telegram —à–ª—ë—Ç webhook. –ù—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ webhook. | –î–ª—è webhook | ‚Äî | Bot |
| `WEBHOOK_SECRET` | –°–µ–∫—Ä–µ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ webhook Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ). | –ù–µ—Ç | ‚Äî | Bot |
| `WEBAPP_URL` | URL Mini App (–Ω–∞–ø—Ä–∏–º–µ—Ä GitHub Pages –∏–ª–∏ —Ö–æ—Å—Ç–∏–Ω–≥ —Å—Ç–∞—Ç–∏–∫–∏); –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–Ω–æ–ø–∫—É ¬´–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ¬ª. | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è | ‚Äî | Bot |
| `BOT_MODE` | –†–µ–∂–∏–º –±–æ—Ç–∞: `polling` –∏–ª–∏ `webhook`. –ï—Å–ª–∏ –ø—É—Å—Ç–æ –∏ –∑–∞–¥–∞–Ω `WEBHOOK_BASE_URL` ‚Äî —Å—á–∏—Ç–∞–µ—Ç—Å—è webhook. | –ù–µ—Ç | `polling` (–µ—Å–ª–∏ –ø—É—Å—Ç–æ) | Bot |

#### Backend (API)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –ö—Ç–æ —á–∏—Ç–∞–µ—Ç |
|------------|----------|----------------|--------------|------------|
| `JWT_SECRET` | –°–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT; –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ª—É—á–∞–π–Ω—ã–º. | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | `change-me` (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ) | API |
| `JWT_TTL_SECONDS` | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ JWT –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä 21600 = 6 —á). | –ù–µ—Ç | `21600` | API |
| `DATABASE_URL` | URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î (SQLite: `sqlite:///./app.db`; Postgres: `postgresql://user:pass@host/db`). | –ù–µ—Ç | `sqlite:///./app.db` | API |
| `ADMIN_TOKEN` | –¢–æ–∫–µ–Ω –¥–ª—è –∞–¥–º–∏–Ω-—ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (–∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>`). –ü—É—Å—Ç–æ ‚Äî –∞–¥–º–∏–Ω–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞. | –ù–µ—Ç | ‚Äî | API |

#### TON (–¥–µ–ø–æ–∑–∏—Ç—ã, webhook)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –ö—Ç–æ —á–∏—Ç–∞–µ—Ç |
|------------|----------|----------------|--------------|------------|
| `TON_WEBHOOK_SECRET` | –°–µ–∫—Ä–µ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ webhook –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ TON API (–∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ —Ç–µ–ª–æ). | –î–ª—è –ø—Ä–∏—ë–º–∞ webhook | ‚Äî | API |
| `TON_PROJECT_WALLET_ADDRESS` | –ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –ø—Ä–∏—ë–º–∞ –¥–µ–ø–æ–∑–∏—Ç–æ–≤ (TON/USDT). | –î–ª—è –¥–µ–ø–æ–∑–∏—Ç–æ–≤ | ‚Äî | API |
| `TON_API_PROVIDER_NAME` | –ò–º—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–¥–ª—è –ª–æ–≥–æ–≤/–∫–æ–Ω—Ñ–∏–≥–∞). | –ù–µ—Ç | ‚Äî | API |
| `TON_API_KEY` | –ö–ª—é—á API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –¥–ª—è –∏—Å—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤). | –ü–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É | ‚Äî | API |

---

### –°–µ–∫—Ä–µ—Ç—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **–ù–µ –∫–æ–º–º–∏—Ç–∏—Ç—å:** `.env`, –ª—é–±—ã–µ —Ñ–∞–π–ª—ã —Å —Ç–æ–∫–µ–Ω–∞–º–∏ –∏ –∫–ª—é—á–∞–º–∏. –í `.gitignore` —É–∂–µ –µ—Å—Ç—å `.env`.
- **–ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å:** –∑–Ω–∞—á–µ–Ω–∏—è `BOT_TOKEN`, `JWT_SECRET`, `ADMIN_TOKEN`, `TON_WEBHOOK_SECRET`, `TON_API_KEY`, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏. –í –ª–æ–≥–∞—Ö ‚Äî —Ç–æ–ª—å–∫–æ —Ñ–∞–∫—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä ¬´auth success¬ª) –±–µ–∑ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤.
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–µ —Å–ª—É—á–∞–π–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è `JWT_SECRET`, `ADMIN_TOKEN`, `TON_WEBHOOK_SECRET`.

---

### –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º | –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ |
|-----------|----------------|----------------------|
| **API** | –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä `JWT_SECRET` –Ω–µ default). | –õ–æ–≥–∏—Ä—É–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ; –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ–º –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ ‚Äî –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä auth). |
| **Bot** | –ù–∞–ª–∏—á–∏–µ `BOT_TOKEN` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ. | –í—ã—Ö–æ–¥ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º `BOT_TOKEN is required`. |
| **–î–µ–ø–ª–æ–π (CI)** | –ù–∞–ª–∏—á–∏–µ –Ω—É–∂–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ GitHub Secrets / env —Ö–æ—Å—Ç–∞. | –ü–∞–π–ø–ª–∞–π–Ω –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–µ–∫—Ä–µ—Ç—ã –≤ –ª–æ–≥–∏; –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö ‚Äî –¥–µ–ø–ª–æ–π –ø–∞–¥–∞–µ—Ç. |

–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —è–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ API (–Ω–∞–ø—Ä–∏–º–µ—Ä Pydantic Settings —Å –ø–æ–ª—è–º–∏ –±–µ–∑ default –¥–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö).

---

## –§–æ—Ä–º–∞—Ç –≤–µ–¥–µ–Ω–∏—è –ª–æ–≥–æ–≤

–ï–¥–∏–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: **—á—Ç–æ** –∂—É—Ä–Ω–∞–ª–∏—Ä—É–µ–º, **–∫–∞–∫** (—Ñ–æ—Ä–º–∞—Ç –∏ –≤—ã–≤–æ–¥), **–≥–¥–µ** (–∫–∞–∫–æ–π –ø—Ä–æ—Ü–µ—Å—Å, –∫—É–¥–∞ –ø–∏—à–µ–º). –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ –¥–æ–ª–∂–Ω–∞ –µ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å; —Ç–µ–∫—É—â–∏–π –∫–æ–¥ ‚Äî –Ω–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã.

---

### –ü—Ä–∏–Ω—Ü–∏–ø—ã

- **–û–¥–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø–∏—Å–µ–π** –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (API, Bot): –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –Ω–∞–±–æ—Ä –ø–æ–ª–µ–π –∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ –∏—Å–∫–∞—Ç—å –ø–æ –≤—Å–µ–º—É –æ–∫—Ä—É–∂–µ–Ω–∏—é.
- **–¢–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏:** –∫–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å ‚Äî –æ–¥–∏–Ω JSON-–æ–±—ä–µ–∫—Ç; –Ω–∏–∫–∞–∫–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –±–µ–∑ –ø–æ–ª–µ–π.
- **–õ–æ–≥–∏ ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –Ω–∞ MVP** (–±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞/–∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ).

---

### –ö–∞–∫: —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–∏ –∏ –≤—ã–≤–æ–¥

**–§–æ—Ä–º–∞—Ç –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏:** –æ–¥–∏–Ω JSON-–æ–±—ä–µ–∫—Ç –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É (NDJSON). –ö–æ–¥–∏—Ä–æ–≤–∫–∞ –≤—ã–≤–æ–¥–∞ ‚Äî UTF-8.

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–µ—Å—Ç—å –≤ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏):**

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `timestamp` | —Å—Ç—Ä–æ–∫–∞ (ISO 8601 UTC) | –ú–æ–º–µ–Ω—Ç —Å–æ–±—ã—Ç–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä `2025-01-29T12:00:00Z`. |
| `level` | —Å—Ç—Ä–æ–∫–∞ | –£—Ä–æ–≤–µ–Ω—å: `DEBUG`, `INFO`, `WARNING`, `ERROR`. |
| `service` | —Å—Ç—Ä–æ–∫–∞ | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞: `api` –∏–ª–∏ `bot`. |
| `event` | —Å—Ç—Ä–æ–∫–∞ | –¢–∏–ø —Å–æ–±—ã—Ç–∏—è (—Å–º. –Ω–∏–∂–µ —Ç–∞–±–ª–∏—Ü—É —Å–æ–±—ã—Ç–∏–π). |
| `message` | —Å—Ç—Ä–æ–∫–∞ | –ö—Ä–∞—Ç–∫–æ–µ —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞, –±–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤). |

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è (–¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∏ —É–º–µ—Å—Ç–Ω–æ—Å—Ç–∏):**

| –ü–æ–ª–µ | –¢–∏–ø | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|------|-----|-------------------|
| `request_id` | —Å—Ç—Ä–æ–∫–∞ | –ó–∞–ø—Ä–æ—Å –∫ API: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞ (–æ–¥–∏–Ω –Ω–∞ –≤–µ—Å—å request/response). |
| `telegram_user_id` | —Å—Ç—Ä–æ–∫–∞ | –î–µ–π—Å—Ç–≤–∏–µ —Å–≤—è–∑–∞–Ω–æ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º Telegram; —Ç–æ–ª—å–∫–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, –Ω–µ –∏–º—è –∏ –Ω–µ initData. |
| `tx_hash` | —Å—Ç—Ä–æ–∫–∞ | –°–æ–±—ã—Ç–∏–µ —Å–≤—è–∑–∞–Ω–æ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π –≤ —Å–µ—Ç–∏ (–¥–µ–ø–æ–∑–∏—Ç, –≤—ã–≤–æ–¥). |
| `duration_ms` | —á–∏—Å–ª–æ | –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞). |
| `status_code` | —á–∏—Å–ª–æ | HTTP-–∫–æ–¥ –æ—Ç–≤–µ—Ç–∞ (–¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API). |
| `reason` | —Å—Ç—Ä–æ–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è –∞–¥–º–∏–Ω-–¥–µ–π—Å—Ç–≤–∏–π, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫). |
| `exception` | —Å—Ç—Ä–æ–∫–∞ | –¢–µ–∫—Å—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è + stacktrace –ø—Ä–∏ `level: ERROR` (–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–∏ WARNING). |

–õ—é–±—ã–µ –¥—Ä—É–≥–∏–µ –ø–æ–ª—è, –Ω—É–∂–Ω—ã–µ –ø–æ —Å–º—ã—Å–ª—É —Å–æ–±—ã—Ç–∏—è, –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–µ–∫—Ä–µ—Ç–æ–≤ –∏ –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç –ª–∏—à–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ò–º–µ–Ω–∞ –ø–æ–ª–µ–π ‚Äî –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ, snake_case.

**–ö—É–¥–∞ –ø–∏—à–µ–º:**

| –û–∫—Ä—É–∂–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------------|
| **stdout** | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ –ª–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–±–µ–∑ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–æ–∫–∞–º –∏–ª–∏ —Å line-buffering, —á—Ç–æ–±—ã –ª–æ–≥–∏ –Ω–µ —Ç–µ—Ä—è–ª–∏—Å—å –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏). |
| **–§–∞–π–ª—ã** | –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä `run-dev.ps1`) stdout –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä `logs/<run_id>/api.log`, `bot.log`). –°–∞–º–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã –ª–æ–≥–æ–≤ –Ω–∞ MVP ‚Äî —Ç–æ–ª—å–∫–æ stdout. |
| **–î–µ–ø–ª–æ–π** | –ù–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ –ª–æ–≥–∏ –∏–∑ stdout —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (systemd, Docker, GitHub Actions) –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏; –æ—Ç–¥–µ–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –≤–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ MVP –Ω–µ –¥–µ–ª–∞–µ–º. |

---

### –ß—Ç–æ –∂—É—Ä–Ω–∞–ª–∏—Ä—É–µ–º: —Å–æ–±—ã—Ç–∏—è –∏ –ø–æ–ª—è

**–£—Ä–æ–≤–Ω–∏:**  
- `INFO` ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ö–æ–¥ (–∑–∞–ø—Ä–æ—Å—ã, —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, —Å—Ç–∞—Ä—Ç/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è).  
- `WARNING` ‚Äî –æ–∂–∏–¥–∞–µ–º—ã–µ —Å–±–æ–∏ (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π initData, –æ—Ç–∫–∞–∑ –≤ –¥–æ—Å—Ç—É–ø–µ, –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ comment).  
- `ERROR` ‚Äî –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ –∫–æ–¥–µ, —Å–±–æ–π –ë–î, —Å–±–æ–π –≤–Ω–µ—à–Ω–µ–≥–æ –≤—ã–∑–æ–≤–∞); –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ–ª–µ `exception` —Å–æ stacktrace.  
- `DEBUG` ‚Äî –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏; –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å.

**–°–æ–±—ã—Ç–∏—è (–ø–æ–ª–µ `event`) –∏ —á—Ç–æ –≤ –∑–∞–ø–∏—Å–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –µ—Å—Ç—å:**

| –°–µ—Ä–≤–∏—Å | event | –ö–æ–≥–¥–∞ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∑–∞–ø–∏—Å–∏ (–∫—Ä–æ–º–µ –æ–±—â–∏—Ö) | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è |
|--------|-------|--------|----------------------------------------|--------------------|
| **api** | `request_start` | –í—Ö–æ–¥ HTTP-–∑–∞–ø—Ä–æ—Å–∞ | `request_id`, –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ ‚Äî –º–µ—Ç–æ–¥ –∏ –ø—É—Ç—å | `telegram_user_id` –µ—Å–ª–∏ —É–∂–µ –∏–∑–≤–µ—Å—Ç–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞/cookie |
| **api** | `request_end` | –í—ã—Ö–æ–¥ HTTP-–∑–∞–ø—Ä–æ—Å–∞ | `request_id`, `status_code`, `duration_ms` | `telegram_user_id` |
| **api** | `auth_success` | –£—Å–ø–µ—à–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ initData, –≤—ã–¥–∞–Ω JWT | `telegram_user_id` | `request_id` |
| **api** | `auth_failed` | –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ initData (–Ω–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å, –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ) | ‚Äî | `request_id`, –∫—Ä–∞—Ç–∫–∏–π `reason` (–±–µ–∑ initData –∏ —Å–µ–∫—Ä–µ—Ç–æ–≤) |
| **api** | `ton_webhook_received` | –ü–æ–ª—É—á–µ–Ω webhook –æ—Ç TON API | ‚Äî | `tx_hash`, `currency`, `amount`, `request_id` |
| **api** | `ton_webhook_attributed` | –î–µ–ø–æ–∑–∏—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ –∑–∞—á–∏—Å–ª–µ–Ω | `telegram_user_id`, `tx_hash` | `amount`, `currency`, `request_id` |
| **api** | `ton_webhook_rejected` | –î–µ–ø–æ–∑–∏—Ç –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω (–Ω–µ–≤–µ—Ä–Ω—ã–π comment, –¥—É–±–ª–∏–∫–∞—Ç –∏ —Ç.–ø.) | `tx_hash` –∏–ª–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä | `reason`, `request_id` |
| **api** | `withdraw_created` | –°–æ–∑–¥–∞–Ω–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ | `telegram_user_id` | `request_id`, —Å—É–º–º–∞/–≤–∞–ª—é—Ç–∞ (–±–µ–∑ –∞–¥—Ä–µ—Å–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤ –ª–æ–≥ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏) |
| **api** | `withdraw_sent` | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤—ã–≤–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ —Å–µ—Ç—å | `tx_hash` | `request_id`, `telegram_user_id` |
| **api** | `withdraw_completed` / `withdraw_failed` | –ò—Ç–æ–≥ –≤—ã–≤–æ–¥–∞ | `tx_hash` | `request_id`, `reason` –ø—Ä–∏ failed |
| **api** | `admin_*` | –õ—é–±–æ–µ –∞–¥–º–∏–Ω-–¥–µ–π—Å—Ç–≤–∏–µ (–≤–∫–ª/–≤—ã–∫–ª —Ä—ã–Ω–∫–∞, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞) | `reason` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ), –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ ‚Äî —á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ | –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–±—ä–µ–∫—Ç–∞ (market_id, user_id –∏ —Ç.–¥.); –±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤ |
| **api** | `error` | –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ —Å–±–æ–π | `exception` (stacktrace) | `request_id`, `telegram_user_id`, `tx_hash` –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É |
| **bot** | `webhook_registered` / `polling_started` | –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –≤ —Ä–µ–∂–∏–º–µ webhook –∏–ª–∏ polling | ‚Äî | URL webhook –ø—Ä–∏ webhook |
| **bot** | `command` / `message` | –û–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ (–ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏) | ‚Äî | `telegram_user_id` |
| **bot** | `error` | –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ –±–æ—Ç–µ | `exception` | `telegram_user_id` –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É |

–î–ª—è —Å–æ–±—ã—Ç–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ –Ω–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `event: "log"` –∏ –∑–∞–ø–æ–ª–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –æ–±—â–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–æ–ª—è.

---

### –ß–µ–≥–æ –Ω–µ –∂—É—Ä–Ω–∞–ª–∏—Ä—É–µ–º

- **–°–µ–∫—Ä–µ—Ç—ã –∏ –∫–ª—é—á–∏:** –∑–Ω–∞—á–µ–Ω–∏—è `BOT_TOKEN`, `JWT_SECRET`, `ADMIN_TOKEN`, `TON_WEBHOOK_SECRET`, `TON_API_KEY`, –ª—é–±—ã–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏, –ø–∞—Ä–æ–ª–∏.
- **–ü–æ–ª–Ω—ã–π initData** –∏ –ª—é–±–æ–π payload, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–¥–ø–∏—Å—å –∏–ª–∏ —Ç–æ–∫–µ–Ω—ã.
- **–ê–¥—Ä–µ—Å–∞ –∫–æ—à–µ–ª—å–∫–æ–≤** –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –≤ –º–∞—Å—Å–æ–≤—ã—Ö –ª–æ–≥–∞—Ö (–¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∫—Ä–∞—Ç–∫–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ —ç—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è, –ø–æ —Ä–µ—à–µ–Ω–∏—é).
- **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–≤–µ—Ä—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏:** –∏–º–µ–Ω–∞, —Ñ–∞–º–∏–ª–∏–∏, –∫–æ–Ω—Ç–∞–∫—Ç—ã ‚Äî –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å; `telegram_user_id` ‚Äî —Ç–æ–ª—å–∫–æ –∫–∞–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏ —Ç–æ–ª—å–∫–æ –≥–¥–µ –Ω—É–∂–Ω–æ –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏.

–ü—Ä–∏ —Å–æ–º–Ω–µ–Ω–∏–∏ ‚Äî –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å; –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ-–ø—Ä–æ–¥–∞–∫—à–µ–Ω –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –æ—á–∏—â–∞—Ç—å –ª–æ–≥–∏ –æ—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º/–ø–µ—Ä–µ–¥–∞—á–µ–π.

---

### –ì–¥–µ: –∫–∞–∫–æ–π –ø—Ä–æ—Ü–µ—Å—Å —á—Ç–æ –ø–∏—à–µ—Ç

| –ü—Ä–æ—Ü–µ—Å—Å | –ó–Ω–∞—á–µ–Ω–∏–µ `service` | –ö—É–¥–∞ stdout (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|---------|--------------------|----------------------------|------------|
| **API** (FastAPI/uvicorn) | `api` | stdout –ø—Ä–æ—Ü–µ—Å—Å–∞ | –û–¥–∏–Ω –ø–æ—Ç–æ–∫ –∑–∞–ø–∏—Å–µ–π; `request_id` —Å–≤—è–∑—ã–≤–∞–µ—Ç request_start –∏ request_end. |
| **Bot** (aiogram) | `bot` | stdout –ø—Ä–æ—Ü–µ—Å—Å–∞ | –û—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –æ—Ç API; –ø–æ `telegram_user_id` –∏ –≤—Ä–µ–º–µ–Ω–∏ –º–æ–∂–Ω–æ —Å–æ–æ—Ç–Ω–æ—Å–∏—Ç—å —Å API –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. |

–õ–æ–≥–∏ API –∏ Bot **–Ω–µ —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è** –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è; —Å–º–µ—à–∏–≤–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–∞ stdout –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª (—Ç–æ–≥–¥–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–ª—é `service`).

---

### –ò—Ç–æ–≥: –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- **–§–æ—Ä–º–∞—Ç:** –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ = –æ–¥–∏–Ω JSON-–æ–±—ä–µ–∫—Ç (NDJSON), UTF-8, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è `timestamp`, `level`, `service`, `event`, `message`; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ ‚Äî –ø–æ —Ç–∞–±–ª–∏—Ü–µ —Å–æ–±—ã—Ç–∏–π –∏ —Å–ø–∏—Å–∫—É –ø–æ–ª–µ–π –≤—ã—à–µ.
- **–ß—Ç–æ:** –∂—É—Ä–Ω–∞–ª–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã (–∏ `log`/`error` –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏); –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏–π ‚Äî —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –ø–æ–ª—è, –±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤ –∏ –ª–∏—à–Ω–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
- **–ì–¥–µ:** –ø–∏—à–µ–º –≤ stdout; –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª—ã ‚Äî –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Å–∫—Ä–∏–ø—Ç–∞ –∑–∞–ø—É—Å–∫–∞ –∏–ª–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- –ü—Ä–∏ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–∏ –∫–æ–¥–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —ç—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª, –∞ –Ω–µ –Ω–∞ —Ç–µ–∫—É—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é.

